
# ModelSim

ModelSim は Verilog の論理検証を行うためのシミュレータです．この実験では，主にこの ModelSim を使ってソースのデバッグを行います．

## シミュレーションの仕方

まず，各ウィンドウの役割について簡単に説明してから，次にシミュレーションのやりかたを説明します．
ここでは，各サンプル内で "make sim-gui" からModelSim を立ち上げた直後の状態を前提として説明をします．
この状態では，make によってコンパイルされたモジュールが ModelSim に読み込まれています．

### ウィンドウ
ModelSim のウィンドウの中で，主に使用するサブウィンドウを下記で簡単に説明します．

#### Structure
* モジュールの階層をみるためのウィンドウです．
    * このウィンドウで選択したモジュールの信号線やFFが，Obejctsなどのウィンドウ （後述）に表示されます．
* 初期状態では左端に表示されています．
* 表示されていない場合，メニューの View -> Structure で表示させることができます．
* Adder のサンプルでは，H3_Simulator/adder と言った階層がみえているはずです．

#### Objects
* 信号線やフリップ・フロップを見るためのウィンドウです．
* 初期状態では中央上側に表示されています．
* 表示されていない場合，メニューの View -> Objects で表示させることができます．
* Structure 内で選択されているモジュール内のものがここに表示されます．
* デフォルトでは2進数で表示されていますが，右クリックから "Global Signal Radix..." を選択し，その中で設定を行うことで10進や16進で表示できるようになります．
    * ModelSim 自体の設定でデフォルトのフォーマットを変えられたかも．

#### Wave
* 信号の変化を波形としてみるためのウィンドウです．
* 初期状態では右側に表示されています．
* 表示されていない場合，メニューの View -> Wave で表示させることができます．
* Obejcts 内の信号線などを，この Wave ウィンドウにドラッグ&ドロップすることで，波形の表示を行うことができます．
* 右クリック -> Radix から設定することで，表示を10進数や16進数に切りかえられます
    * シフトを押しながら信号をまとめて選択することで，一気に複数の信号の表示設定を変えることができます
#### Transcript
* いわゆるコンソールです．
* 初期状態では下側に表示されています．
* 検証用コードで文字列の出力を行った場合，ここに表示されます．


### シミュレーションの実行方法

* シミュレーションは，主に "simulate" ツールバーから行います
    * "100 ns" など，時間設定が書いてあるボックスがあるツールバーです
    * ツールバー上の各ボタンの上にマウスカーソルをかざすと，ボタン名が見えます
* Run ボタンを押すと，時間設定のボックスで指定しただけ時間が進みます
* Restart ボタンを押すと，シミュレーションを最初からやりなおします
* 波形の拡大縮小は，虫眼鏡のアイコンのボタンでできます
#### 典型的な使い方
基本的には，以下の流れで作業をおこないます．
 ソース・コードを修正 -> make -> Restart -> 波形を見る -> ソース・コードを修正 -> make ...

* make sim-gui は最初の1回のみでよいです．
* make でソース・コードをコンパイルした場合，Restart を押すことで変更が反映されたモジュールでのシミュレーションが行われます．


## その他
### コマンドライン版の使い方
"make sim" と打てば，最後まで（無限に）シミュレーションを行い，コンソールに結果を出力します．

直接叩く場合，チュートリアルの加算器の中の Makefile にコマンドライン版を起動している部分がありますので，それを参考にしてください．

## Tips
### wave ビューアのデフォルトの表示形式の変更
* メニューのSimulate > Runtime Options から設定可能

### wave ビューアにセットした信号の保存と読み込み
* File->Save format で保存，File->Load から読み込みが行える
* Wave->Wave Preferences のOn Close Warn for Sav Format にチェックを入れると，終了時に保存するか聞いてくれる
