# スケジュール

## 1回目
[第１回目スライド](slides/01.pptx)を見てから行う．
* 実験環境の設定
    * [実験の準備](setup.md)を参照
* ソート・アルゴリズムをC言語等で記述
    * 具体的な作業は，[ソート・プログラム](tutorial/sort.md) を参照してください．
* 命令セットとアーキテクチャの検討
    * 上記のソート・プログラムを実現するのに必要な命令のセットを検討してください．
    * 命令セットの検討には，教科書（パタソン&ヘネシー 上巻）の2章を参考にすると良いです．この章ではC言語の各文がどのような機械語に対応するのかが説明されています．これを参考にして，上で書いたソート・プログラムを実現するためにはどのような命令が必要になるのかを考えてください．
    * パタヘネでは MIPS に基づいていますが，RISC-V に従うのがよいです

### レポート

* 内容：
    * C言語で書いたソート・アルゴリズム

## 2回目
[第２回目スライド](slides/02.pptx)を見てから行う．
* [チュートリアル](tutorial.md) の加算器とレジスタ・ファイルの2つを各自で実施
    * それぞれのチュートリアルの最後に課題があるので，それをやって提出してください．
    * Verilog の文法については WEB を見たり本を買ってきた方がよいです．
    * [Verilogの記法について](verilog.md)をよく読んでからソースを書いてください．守られていない場合，レポートは再提出になります．
* 命令セットの設計とそれを用いたソート・アルゴリズム記述
    * 実際に使う命令セットを定義し，それを使って前日に書いたソート・アルゴリズムを実現するアセンブリのプログラムを書いてください．
    * 命令セットの設計では，コードのフォーマットも定義して提出すること
* プロセッサの仕様（3回目に出す仕様レポートの内容）を決定してください．
    * パタソン&ヘネシー（下）（第５版は上巻）のシングルサイクル・マシンを参考にすると良いです．
    * 外部との入出力の仕様については，[プロセッサの仕様](specification.md)に従ってください．

### レポート
* 内容：
    * チュートリアルの課題とその結果
        * ソースコード
        * 結果の波形のスクリーンショットと，その解説
    * 命令セットの定義（以下で説明するコードフォーマットの表）
    * ソート・アルゴリズムを実現するアセンブリのプログラム

### コードのフォーマットの例
パタソン&ヘネシー上巻83ページ(第5版の場合．第4版の場合89ページ．第3版では58ページ)の図を参考にして，コードのフォーマットの表を作って下さい．
以下はコードのフォーマットの例です．このような形で，定義した全ての命令の表を作って下さい．

* R 形式

    | フィールド名 | op | rs | rt | rd | shamt | funct |
    | ----------- | :--: | :--: | :--: | :--: | :-----: | :-----: |
    |ビット幅|6|5|5|5|5|6|

* I 形式
    |フィールド名|op|rs|rt|constant|
    | ----------- | :--: | :--: | :--: | :--: |
    |ビット幅|6|5|5|16|

* 命令の符号化
    |命令|形式|op|rs|rt|rd|shamt|funct|address|
    | ----------- | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
    |add|R|0|レジスタ|レジスタ|レジスタ|0|32|使用しない|

## 3回目
[第３回目スライド](slides/03.pptx)を見てから行う．
プロセッサの仕様を設計し，以下のものを紙に書いてください．
* 使用する制御線とデータ線（名称と役割について書く）
* プロセッサのブロック図


### 注意
* 制御線やデータ線の名前，モジュール名は Verilog の命名規則に従ってください
    * 基本的に名前は， aluOut, memWriteEnable のように小文字始まりで以降単語毎に頭が大文字になるはずです．
    * 実験の説明のページではこのルールにしたがっていないですが，上記ルールにあわせてください．
* ブロック図では，必ず全ての信号線に名前を書いてください

### 仕様レポート
**次回実験時に紙で提出してください**
* 内容：
    * 使用する制御線とデータ線（名称と役割について書く）
    * プロセッサのブロック図

## 4回目
* [シングルサイクルマシン](tutorial/single.md) を参考にして，実際の設計をはじめてください．
    * tutorial/processor 内のひな型に，必要なファイルを足していく形で作業を進めてください．
    * exapmle/singlecycle 以下にシングルサイクルマシンの簡単なサンプルがありますので参考にしてください．
    * このサンプルは実験の仕様を満たしていませんし，FPGA 上で動作しない可能性もありますので注意してください．
* 今日の課題
    * ALU，レジスタ・ファイル，PC を作ってそれぞれの動作を検証
    * PCと命令メモリを繋げて，命令データが毎サイクル読み出されるところまでを確認

### レポート
**次回実験時に進捗レポートに加えて提出してください**
* 内容：
    * ＡＬＵ、ＰＣのソースコードと実行結果

## 5回目
* 開始時に進捗レポートをだしてください
* がんがん設計

## 6回目
* どんどん設計

## 7回目
* 開始時に進捗レポートをだしてください
* 設計と検証
### 次回に出すレポート
* 次回の進捗レポートには以下のものを含めて下さい
    * add 命令を解釈して，ソース・オペランドをレジスタ・ファイルから読み込んでいることがわかる実行結果
        *  たとえば，命令内の rs とか rt フィールドを切り出してレジスタ・ファイルに入力し，値が取り出せてる様子
        *  実行結果は ModelSim の波形ビューアのスクリーンショットを提出してください
        *  本文に，スクリーンショットの解説をつけてください
* スクリーンショットの取り方の例
    * スクリーンショットをクリップボードにコピー
        * 画面を記録したいところで，Alt + PrintScreen キー（キーボードの右上の方にある）を押す
    * ペイントを起動
        * スタートメニューのファイル名を指定して実行 から mspaint.exe と打って起動
    * ペイントに貼り付ける
        *  ペイント上でctrl + v

## 8回目
* 設計と検証


## 9回目
* 開始時に進捗レポートをだしてください


### ModelSim での論理検証が終わった人は
ソートプログラムが動作するようになった人は，以下の作業に進んでください．
* [プロセッサの仕様](specification.md) のページに従って，プログラムのソート以外の部分をつくってください．
* Quartus Prime で検証を行います
    * Quartus Prime の追加方法はこっち：[Quartus Prime](quartus.md)
    * [性能評価の仕方](evaluation.md) を参考にして，評価を行ってください．

* シングルサイクル・マシンをボード上で動作させることに成功した人は，パイプライン化したプロセッサの設計をはじめてください．
    * ボードがない場合は，ある程度大きなデータセット（できれば4096個．シミュレーションが長すぎる場合は1024個～でも可）に対してModelSim上でデータ・メモリの中身が正しくソートされるのを確認できればOKです．
    * パイプライン化する際の注意については，[高速化に向けて](optimize.md) を参照してください．

### 次回の進捗レポート
* 次回の進捗レポートには以下のものを含めて下さい
    * add 命令，load 命令 がそれぞれ正しく実行されている様子を，前回と同様にして提出してください
    * クロック波形，PC，レジスタ・ファイルやメモリの中身を表示し，そこが正しく書き換わっている様子など


## 10回目
* 設計を進める

## 11回目
* 開始時に進捗レポートをだしてください

### 次回の進捗レポート
次回の進捗レポートには以下のものを含めて下さい
* PCや命令コード，レジスタやメモリの中身を波形で表示させ，ソートが出来ている様子を，前回と同様にして提出してください．

## 12回目
* 開始時に進捗レポートをだしてください
* 設計を進める


## 13回目
* 開始時に進捗レポートをだしてください

## 14回目
* パイプライン版プロセッサの設計
    * 単位取得の条件：パイプライン版のプロセッサをボード上で動作させること
* ボードで動作していない人はがんばる

### 次回の進捗レポート
* 次回の進捗レポートには以下のものを含めて下さい
    * FPGA 上での動作の確認
    * FPGA 上で表示される，ソート終了までにかかったサイクル数
    * [Quartus Prime](quartus.md) 上で表示される動作周波数
        *  シングルサイクルの場合は，表示されるサイクル数を1/4にする

## 15回目
* 開始時に進捗レポートをだしてください

## 16回目

* がんばって書いてデバッグ
* この日中に以下の3つをTAまでメールして下さい．
    * ボードでのソート完了までのサイクル数
    * 動作周波数(動作周期)   [性能評価の仕方](evaluation.md)
    * 利用したソートアルゴリズム名

